<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Net::SSH::Authentication::Agent</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Net::SSH::Authentication::Agent</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/net/ssh/authentication/agent_rb.html">
                lib/net/ssh/authentication/agent.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This class implements a simple client for the ssh-agent protocol. It does
not implement any specific protocol, but instead copies the behavior of the
ssh-agent functions in the OpenSSH library (3.8).
</p>
<p>
This means that although it behaves like a SSH1 client, it also has some
SSH2 functionality (like signing data).
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000124">close</a>&nbsp;&nbsp;
      <a href="#M000119">connect</a>&nbsp;&nbsp;
      <a href="#M000121">connect!</a>&nbsp;&nbsp;
      <a href="#M000123">identities</a>&nbsp;&nbsp;
      <a href="#M000122">negotiate!</a>&nbsp;&nbsp;
      <a href="#M000120">new</a>&nbsp;&nbsp;
      <a href="#M000125">sign</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="../Loggable.html">Loggable</a></span>
      </div>
    </div>

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="Agent/Comment.html" class="link">Net::SSH::Authentication::Agent::Comment</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_REQUEST_VERSION</td>
          <td>=</td>
          <td class="context-item-value">1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_REQUEST_IDENTITIES</td>
          <td>=</td>
          <td class="context-item-value">11</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_IDENTITIES_ANSWER</td>
          <td>=</td>
          <td class="context-item-value">12</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_SIGN_REQUEST</td>
          <td>=</td>
          <td class="context-item-value">13</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_SIGN_RESPONSE</td>
          <td>=</td>
          <td class="context-item-value">14</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_FAILURE</td>
          <td>=</td>
          <td class="context-item-value">30</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH2_AGENT_VERSION_RESPONSE</td>
          <td>=</td>
          <td class="context-item-value">103</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH_COM_AGENT2_FAILURE</td>
          <td>=</td>
          <td class="context-item-value">102</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH_AGENT_REQUEST_RSA_IDENTITIES</td>
          <td>=</td>
          <td class="context-item-value">1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH_AGENT_RSA_IDENTITIES_ANSWER1</td>
          <td>=</td>
          <td class="context-item-value">2</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH_AGENT_RSA_IDENTITIES_ANSWER2</td>
          <td>=</td>
          <td class="context-item-value">5</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SSH_AGENT_FAILURE</td>
          <td>=</td>
          <td class="context-item-value">5</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">socket</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The underlying socket being used to communicate with the <a
href="../../SSH.html">SSH</a> agent.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">connect</span><span class="method-args">(logger=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Instantiates a <a href="Agent.html#M000120">new</a> agent object, connects
to a running <a href="../../SSH.html">SSH</a> agent, negotiates the agent
protocol version, and returns the agent object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-identifier">logger</span>=<span class="ruby-keyword kw">nil</span>)
52:       <span class="ruby-identifier">agent</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">logger</span>)
53:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">connect!</span>
54:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">negotiate!</span>
55:       <span class="ruby-identifier">agent</span>
56:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(logger=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="Agent.html#M000120">new</a> <a
href="Agent.html">Agent</a> object, using the optional logger instance to
report status.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 60</span>
60:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">logger</span>=<span class="ruby-keyword kw">nil</span>)
61:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-identifier">logger</span>
62:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">close</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Closes this socket. This agent reference is no longer able to query the
agent.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 112</span>
112:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
113:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">close</span>
114:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">connect!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Connect to the agent process using the socket factory and socket name given
by the attribute writers. If the agent on the other end of the socket
reports that it is an SSH2-compatible agent, this will fail (it only
supports the ssh-agent distributed by OpenSSH).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 68</span>
68:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect!</span>
69:       <span class="ruby-keyword kw">begin</span>
70:         <span class="ruby-identifier">debug</span> { <span class="ruby-value str">&quot;connecting to ssh-agent&quot;</span> }
71:         <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">agent_socket_factory</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'SSH_AUTH_SOCK'</span>])
72:       <span class="ruby-keyword kw">rescue</span>
73:         <span class="ruby-identifier">error</span> { <span class="ruby-value str">&quot;could not connect to ssh-agent&quot;</span> }
74:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">AgentNotAvailable</span>, <span class="ruby-identifier">$!</span>.<span class="ruby-identifier">message</span>
75:       <span class="ruby-keyword kw">end</span>
76:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">identities</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return an array of all <a href="Agent.html#M000123">identities</a> (public
keys) known to the agent. Each key returned is augmented with a
<tt>comment</tt> property which is set to the comment returned by the agent
for that key.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 94</span>
 94:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">identities</span>
 95:       <span class="ruby-identifier">type</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">send_and_wait</span>(<span class="ruby-constant">SSH2_AGENT_REQUEST_IDENTITIES</span>)
 96:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">AgentError</span>, <span class="ruby-value str">&quot;could not get identity count&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent_failed</span>(<span class="ruby-identifier">type</span>)
 97:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">AgentError</span>, <span class="ruby-node">&quot;bad authentication reply: #{type}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SSH2_AGENT_IDENTITIES_ANSWER</span>
 98: 
 99:       <span class="ruby-identifier">identities</span> = []
100:       <span class="ruby-identifier">body</span>.<span class="ruby-identifier">read_long</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
101:         <span class="ruby-identifier">key</span> = <span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">body</span>.<span class="ruby-identifier">read_string</span>).<span class="ruby-identifier">read_key</span>
102:         <span class="ruby-identifier">key</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Comment</span>)
103:         <span class="ruby-identifier">key</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">read_string</span>
104:         <span class="ruby-identifier">identities</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">key</span>
105:       <span class="ruby-keyword kw">end</span>
106: 
107:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">identities</span>
108:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">negotiate!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Attempts to negotiate the <a href="../../SSH.html">SSH</a> agent protocol
version. Raises an error if the version could not be negotiated
successfully.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">negotiate!</span>
81:       <span class="ruby-comment cmt"># determine what type of agent we're communicating with</span>
82:       <span class="ruby-identifier">type</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">send_and_wait</span>(<span class="ruby-constant">SSH2_AGENT_REQUEST_VERSION</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-constant">Transport</span><span class="ruby-operator">::</span><span class="ruby-constant">ServerVersion</span><span class="ruby-operator">::</span><span class="ruby-constant">PROTO_VERSION</span>)
83: 
84:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SSH2_AGENT_VERSION_RESPONSE</span>
85:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;SSH2 agents are not yet supported&quot;</span>
86:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SSH_AGENT_RSA_IDENTITIES_ANSWER1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SSH_AGENT_RSA_IDENTITIES_ANSWER2</span>
87:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">AgentError</span>, <span class="ruby-node">&quot;unknown response from agent: #{type}, #{body.to_s.inspect}&quot;</span>
88:       <span class="ruby-keyword kw">end</span>
89:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">sign</span><span class="method-args">(key, data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Using the agent and the given public key, <a
href="Agent.html#M000125">sign</a> the given data. The signature is
returned in SSH2 format.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/agent.rb, line 118</span>
118:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sign</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">data</span>)
119:       <span class="ruby-identifier">type</span>, <span class="ruby-identifier">reply</span> = <span class="ruby-identifier">send_and_wait</span>(<span class="ruby-constant">SSH2_AGENT_SIGN_REQUEST</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">:key</span>, <span class="ruby-identifier">key</span>), <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">:long</span>, <span class="ruby-value">0</span>)
120: 
121:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent_failed</span>(<span class="ruby-identifier">type</span>)
122:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">AgentError</span>, <span class="ruby-value str">&quot;agent could not sign data with requested identity&quot;</span>
123:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SSH2_AGENT_SIGN_RESPONSE</span>
124:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">AgentError</span>, <span class="ruby-node">&quot;bad authentication response #{type}&quot;</span>
125:       <span class="ruby-keyword kw">end</span>
126: 
127:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">reply</span>.<span class="ruby-identifier">read_string</span>
128:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>